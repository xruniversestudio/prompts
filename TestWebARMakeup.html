<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªØ¬Ø±Ø¨Ø© Ù…ÙƒÙŠØ§Ø¬ Ø§ÙØªØ±Ø§Ø¶ÙŠ</title>
  <style>
    body { 
      margin: 0; 
      padding: 20px;
      background: #1a1a1a;
      color: white;
      font-family: Arial, sans-serif;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }
    .video-container {
      position: relative;
      margin: 20px 0;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    video, canvas {
      display: block;
      width: 100%;
      height: auto;
      max-width: 640px;
      max-height: 480px;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
    .controls {
      margin: 20px 0;
    }
    button {
      background: linear-gradient(45deg, #ff6b6b, #ff8e53);
      border: none;
      padding: 12px 24px;
      margin: 5px;
      border-radius: 25px;
      color: white;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.05);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .status {
      margin: 10px 0;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      font-family: monospace;
    }
    .makeup-options {
      margin: 20px 0;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .makeup-btn {
      background: rgba(255,255,255,0.2);
      border: 2px solid transparent;
    }
    .makeup-btn.active {
      border-color: #ff6b6b;
      background: rgba(255,107,107,0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ÙƒÙŠØ§Ø¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</h1>
    
    <div class="controls">
      <button id="startBtn">ğŸ“¹ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
      <button id="stopBtn" disabled>â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
    </div>

    <div class="makeup-options">
      <button class="makeup-btn" id="lipstickBtn">ğŸ’‹ Ø£Ø­Ù…Ø± Ø§Ù„Ø´ÙØ§Ù‡</button>
      <button class="makeup-btn" id="blushBtn">ğŸŒ¸ Ø£Ø­Ù…Ø± Ø§Ù„Ø®Ø¯ÙˆØ¯</button>
      <button class="makeup-btn" id="eyeshadowBtn">ğŸ‘ï¸ Ø¸Ù„Ø§Ù„ Ø§Ù„Ø¹ÙŠÙˆÙ†</button>
      <button class="makeup-btn" id="clearBtn">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
    </div>

    <div class="status" id="status">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ø¨Ø¯Ø¡</div>

    <div class="video-container">
      <video id="video" autoplay playsinline muted style="display: none;"></video>
      <canvas id="overlay"></canvas>
    </div>
  </div>

  <!-- TensorFlow.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.15.0/tf.min.js"></script>
  <!-- Face Detection Model -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/face-api.js/0.22.2/face-api.min.js"></script>

  <script>
    let video, canvas, ctx;
    let stream = null;
    let isRunning = false;
    let detectionInterval = null;
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙƒÙŠØ§Ø¬
    const makeupSettings = {
      lipstick: true,
      blush: true,
      eyeshadow: false
    };

    // Ø¹Ù†Ø§ØµØ± DOM
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const status = document.getElementById('status');
    const lipstickBtn = document.getElementById('lipstickBtn');
    const blushBtn = document.getElementById('blushBtn');
    const eyeshadowBtn = document.getElementById('eyeshadowBtn');
    const clearBtn = document.getElementById('clearBtn');

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    function updateButtons() {
      lipstickBtn.classList.toggle('active', makeupSettings.lipstick);
      blushBtn.classList.toggle('active', makeupSettings.blush);
      eyeshadowBtn.classList.toggle('active', makeupSettings.eyeshadow);
    }

    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    startBtn.addEventListener('click', startCamera);
    stopBtn.addEventListener('click', stopCamera);
    
    lipstickBtn.addEventListener('click', () => {
      makeupSettings.lipstick = !makeupSettings.lipstick;
      updateButtons();
    });
    
    blushBtn.addEventListener('click', () => {
      makeupSettings.blush = !makeupSettings.blush;
      updateButtons();
    });
    
    eyeshadowBtn.addEventListener('click', () => {
      makeupSettings.eyeshadow = !makeupSettings.eyeshadow;
      updateButtons();
    });
    
    clearBtn.addEventListener('click', () => {
      makeupSettings.lipstick = false;
      makeupSettings.blush = false;
      makeupSettings.eyeshadow = false;
      updateButtons();
    });

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    async function startCamera() {
      try {
        status.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬...';
        
        // ØªØ­Ù…ÙŠÙ„ Ù†Ù…Ø§Ø°Ø¬ face-api.js
        await loadModels();
        
        status.textContent = 'ğŸ“¹ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...';
        
        video = document.getElementById('video');
        canvas = document.getElementById('overlay');
        ctx = canvas.getContext('2d');

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        stream = await navigator.mediaDevices.getUserMedia({ 
          video: { 
            width: 640, 
            height: 480,
            facingMode: 'user'
          } 
        });
        
        video.srcObject = stream;
        
        await new Promise(resolve => {
          video.onloadedmetadata = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            video.style.display = 'block';
            resolve();
          };
        });

        await video.play();
        
        startBtn.disabled = true;
        stopBtn.disabled = false;
        isRunning = true;
        
        status.textContent = 'âœ… Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...';
        
        // Ø¨Ø¯Ø¡ Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„
        startDetection();
        
      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:', err);
        status.textContent = 'âŒ Ø®Ø·Ø£: ' + err.message;
      }
    }

    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    function stopCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
      
      if (detectionInterval) {
        clearInterval(detectionInterval);
        detectionInterval = null;
      }
      
      video.style.display = 'none';
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      startBtn.disabled = false;
      stopBtn.disabled = true;
      isRunning = false;
      
      status.textContent = 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
    async function loadModels() {
      const MODEL_URL = 'https://cdnjs.cloudflare.com/ajax/libs/face-api.js/0.22.2/models';
      
      await Promise.all([
        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),
        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL)
      ]);
    }

    // Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„
    function startDetection() {
      detectionInterval = setInterval(async () => {
        if (!isRunning || !video || video.paused) return;
        
        await detectAndDraw();
      }, 100); // ÙƒÙ„ 100ms
    }

    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ¬Ù‡ ÙˆØ§Ù„Ø±Ø³Ù…
    async function detectAndDraw() {
      try {
        // Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ¬Ù‡
        const detections = await faceapi
          .detectAllFaces(video, new faceapi.TinyFaceDetectorOptions())
          .withFaceLandmarks();

        if (detections.length > 0) {
          status.textContent = `âœ… ØªÙ… Ø§ÙƒØªØ´Ø§Ù ${detections.length} ÙˆØ¬Ù‡`;
          
          detections.forEach(detection => {
            const landmarks = detection.landmarks;
            
            // Ø±Ø³Ù… Ø£Ø­Ù…Ø± Ø§Ù„Ø´ÙØ§Ù‡
            if (makeupSettings.lipstick) {
              drawLipstick(landmarks);
            }
            
            // Ø±Ø³Ù… Ø£Ø­Ù…Ø± Ø§Ù„Ø®Ø¯ÙˆØ¯
            if (makeupSettings.blush) {
              drawBlush(landmarks);
            }
            
            // Ø±Ø³Ù… Ø¸Ù„Ø§Ù„ Ø§Ù„Ø¹ÙŠÙˆÙ†
            if (makeupSettings.eyeshadow) {
              drawEyeshadow(landmarks);
            }
          });
        } else {
          status.textContent = 'ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¬ÙˆÙ‡...';
        }
        
      } catch (err) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„:', err);
        status.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„';
      }
    }

    // Ø±Ø³Ù… Ø£Ø­Ù…Ø± Ø§Ù„Ø´ÙØ§Ù‡
    function drawLipstick(landmarks) {
      const mouth = landmarks.getMouth();
      
      ctx.fillStyle = 'rgba(220, 20, 60, 0.6)';
      ctx.beginPath();
      
      mouth.forEach((point, index) => {
        if (index === 0) {
          ctx.moveTo(point.x, point.y);
        } else {
          ctx.lineTo(point.x, point.y);
        }
      });
      
      ctx.closePath();
      ctx.fill();
    }

    // Ø±Ø³Ù… Ø£Ø­Ù…Ø± Ø§Ù„Ø®Ø¯ÙˆØ¯
    function drawBlush(landmarks) {
      const leftCheek = landmarks.getLeftCheek();
      const rightCheek = landmarks.getRightCheek();
      
      ctx.fillStyle = 'rgba(255, 182, 193, 0.4)';
      
      // Ø§Ù„Ø®Ø¯ Ø§Ù„Ø£ÙŠØ³Ø±
      if (leftCheek.length > 0) {
        const centerLeft = leftCheek[Math.floor(leftCheek.length / 2)];
        ctx.beginPath();
        ctx.arc(centerLeft.x, centerLeft.y, 25, 0, Math.PI * 2);
        ctx.fill();
      }
      
      // Ø§Ù„Ø®Ø¯ Ø§Ù„Ø£ÙŠÙ…Ù†
      if (rightCheek.length > 0) {
        const centerRight = rightCheek[Math.floor(rightCheek.length / 2)];
        ctx.beginPath();
        ctx.arc(centerRight.x, centerRight.y, 25, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // Ø±Ø³Ù… Ø¸Ù„Ø§Ù„ Ø§Ù„Ø¹ÙŠÙˆÙ†
    function drawEyeshadow(landmarks) {
      const leftEye = landmarks.getLeftEye();
      const rightEye = landmarks.getRightEye();
      
      ctx.fillStyle = 'rgba(138, 43, 226, 0.3)';
      
      // Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„ÙŠØ³Ø±Ù‰
      if (leftEye.length > 0) {
        ctx.beginPath();
        leftEye.forEach((point, index) => {
          if (index === 0) {
            ctx.moveTo(point.x, point.y - 10);
          } else {
            ctx.lineTo(point.x, point.y - 5);
          }
        });
        ctx.closePath();
        ctx.fill();
      }
      
      // Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„ÙŠÙ…Ù†Ù‰
      if (rightEye.length > 0) {
        ctx.beginPath();
        rightEye.forEach((point, index) => {
          if (index === 0) {
            ctx.moveTo(point.x, point.y - 10);
          } else {
            ctx.lineTo(point.x, point.y - 5);
          }
        });
        ctx.closePath();
        ctx.fill();
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    updateButtons();
  </script>
</body>
</html>
