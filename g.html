<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>تجربة الواقع المعزز - مكعب ثلاثي الأبعاد</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@master/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            overflow: hidden;
            background: #000;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            width: 100vw;
            height: 100vh;
        }
        
        .arjs-loader {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
            transition: opacity 0.5s ease;
        }
        
        .loader-content {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        
        .loader-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #4fc3f7;
        }
        
        .loading-text {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #4fc3f7;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1.5s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .instructions {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            padding: 20px 15px;
            z-index: 100;
            font-size: 16px;
            transition: opacity 0.3s ease;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .surface-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border: 3px solid #4fc3f7;
            border-radius: 50%;
            z-index: 90;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
        
        .surface-indicator.active {
            opacity: 1;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
        }
        
        .surface-message {
            position: absolute;
            top: 35%;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            z-index: 100;
            font-size: 18px;
            transition: opacity 0.5s ease;
            opacity: 0;
            border-top: 2px solid #4fc3f7;
            border-bottom: 2px solid #4fc3f7;
        }
        
        .surface-message.active {
            opacity: 1;
        }
        
        .version {
            position: absolute;
            top: 15px;
            right: 15px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
            direction: ltr;
        }
        
        .hint {
            position: absolute;
            top: 25%;
            left: 0;
            width: 100%;
            color: white;
            text-align: center;
            z-index: 80;
            opacity: 0.8;
            font-size: 16px;
            transition: opacity 0.5s ease;
            padding: 0 15px;
        }
        
        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 12px 15px;
            z-index: 100;
            font-size: 14px;
            text-align: center;
            border-bottom: 1px solid #333;
        }
        
        .tap-hint {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(79, 195, 247, 0.8);
            padding: 10px 20px;
            border-radius: 25px;
            z-index: 90;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }
        
        .tap-hint.active {
            opacity: 1;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
        
        .start-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #4fc3f7;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            z-index: 101;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .start-button:hover {
            background: #29b6f6;
            transform: translate(-50%, -50%) scale(1.05);
        }
        
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 102;
            max-width: 80%;
            display: none;
        }
        
        /* إزالة تأثيرات الكاميرا غير المرغوب فيها */
        .a-enter-vr {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="arjs-loader">
        <div class="loader-content">
            <h1 class="loader-title">تجربة الواقع المعزز</h1>
            <div class="spinner"></div>
            <div class="loading-text">جاري تحميل تجربة الواقع المعزز...</div>
            <p>يرجى منح الإذن لاستخدام الكاميرا عند المطالبة</p>
            <p style="margin-top: 15px; font-size: 14px; opacity: 0.8;">حرك هاتفك ببطء في مختلف الاتجاهات لاكتشاف الأسطح</p>
        </div>
    </div>

    <button class="start-button" id="startButton">بدء التجربة</button>
    
    <div class="error-message" id="errorMessage">
        <h3>حدث خطأ في تحميل الكاميرا</h3>
        <p>يرجى التأكد من منح الإذن لاستخدام الكاميرا وتحديث الصفحة</p>
        <button onclick="window.location.reload()" style="margin-top: 15px; padding: 10px 20px; background: #4fc3f7; color: white; border: none; border-radius: 5px; cursor: pointer;">إعادة تحميل الصفحة</button>
    </div>

    <div class="status-bar">انقر على "بدء التجربة" لتفعيل الكاميرا</div>
    <div class="surface-indicator"></div>
    <div class="surface-message">تم اكتشاف سطح - انقر لوضع المكعب</div>
    <div class="hint">حرك هاتفك لاكتشاف الأسطح المحيطة</div>
    <div class="version">الإصدار 2.1.4</div>
    <div class="tap-hint">انقر هنا</div>
    
    <div class="instructions">
        انقر على "بدء التجربة" لتفعيل الكاميرا والبدء
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        embedded
        renderer="logarithmicDepthBuffer: true; colorManagement: true;"
        gesture-detector
        id="arScene"
        style="display: none;"
    >

        <!-- كاميرا طبيعية بدون تأثيرات مبالغ فيها -->
        <a-entity id="rig" movement-controls>
            <a-entity 
                camera 
                look-controls="enabled: false" 
                position="0 1.6 0"
                fov="60"
                near="0.1"
                far="1000"
                wasd-controls="enabled: false">
            </a-entity>
        </a-entity>

        <!-- ضوء للمشهد -->
        <a-light 
            type="directional" 
            position="2 5 3" 
            intensity="0.8" 
            cast-shadow>
        </a-light>
        
        <a-light 
            type="ambient" 
            intensity="0.4">
        </a-light>
        
        <!-- ضوء مساعد -->
        <a-light
            type="point"
            position="0 3 0"
            intensity="0.3"
            distance="10">
        </a-light>

        <!-- مؤشر لوضع المكعب -->
        <a-entity 
            cursor 
            id="cursor" 
            raycaster="objects: .clickable; far: 100; interval: 1000;" 
            position="0 0 -1.5" 
            geometry="primitive: ring; radiusInner: 0.008; radiusOuter: 0.012"
            material="color: #4fc3f7; shader: flat; opacity: 0.8">
            <a-animation 
                begin="click" 
                easing="ease-in" 
                attribute="scale" 
                fill="forwards" 
                from="1 1 1" 
                to="2 2 2" 
                dur="200">
            </a-animation>
            <a-animation 
                begin="click" 
                easing="ease-in" 
                attribute="material.opacity" 
                from="0.8" 
                to="0" 
                dur="200">
            </a-animation>
        </a-entity>

        <!-- شبكة اكتشاف الأسطح (ستظهر عند اكتشاف سطح) -->
        <a-entity 
            id="surfaceGrid" 
            class="clickable"
            visible="false" 
            geometry="primitive: plane; width: 1; height: 1" 
            material="color: #4fc3f7; opacity: 0.4; transparent: true; shader: flat" 
            rotation="-90 0 0"
            position="0 0 0">
        </a-entity>

        <!-- المكعب الثلاثي الأبعاد -->
        <a-entity 
            id="cube" 
            visible="false" 
            geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5" 
            material="color: #4fc3f7; metalness: 0.7; roughness: 0.2;" 
            position="0 0.25 0" 
            animation="property: rotation; to: 0 360 0; loop: true; dur: 10000;"
            shadow="cast: true">
            
            <!-- تأثير إشعاعي حول المكعب -->
            <a-ring 
                color="#4fc3f7" 
                radius-inner="0.6" 
                radius-outer="0.8" 
                opacity="0.3" 
                rotation="-90 0 0"
                position="0 0.01 0">
            </a-ring>
            
            <!-- نص يشرح التجربة -->
            <a-text 
                value="تجربة الواقع المعزز" 
                align="center" 
                position="0 0.8 0" 
                color="#FFFFFF" 
                scale="2 2 2">
            </a-text>
            
            <!-- تأثيرات بصرية إضافية -->
            <a-entity
                geometry="primitive: box; width: 0.55; height: 0.55; depth: 0.55"
                material="color: #ffffff; opacity: 0.1; wireframe: true"
                position="0 0 0">
            </a-entity>
        </a-entity>

        <!-- أرضية افتراضية للمساعدة في التموضع -->
        <a-entity 
            id="ground" 
            class="clickable"
            geometry="primitive: plane; width: 100; height: 100" 
            material="color: #222222; opacity: 0.0; transparent: true" 
            rotation="-90 0 0" 
            position="0 0 0"
            visible="true">
        </a-entity>

    </a-scene>

    <script>
        // عناصر واجهة المستخدم
        const loader = document.querySelector('.arjs-loader');
        const startButton = document.getElementById('startButton');
        const errorMessage = document.getElementById('errorMessage');
        const surfaceIndicator = document.querySelector('.surface-indicator');
        const surfaceMessage = document.querySelector('.surface-message');
        const hint = document.querySelector('.hint');
        const instructions = document.querySelector('.instructions');
        const version = document.querySelector('.version');
        const statusBar = document.querySelector('.status-bar');
        const tapHint = document.querySelector('.tap-hint');
        const arScene = document.getElementById('arScene');
        
        // عناصر المشهد
        const scene = document.querySelector('a-scene');
        const cursor = document.querySelector('#cursor');
        const cube = document.querySelector('#cube');
        const surfaceGrid = document.querySelector('#surfaceGrid');
        const ground = document.querySelector('#ground');
        
        // حالة اكتشاف السطح
        let surfaceDetected = false;
        let cubePlaced = false;
        let sceneStarted = false;
        
        // إخفاء شاشة التحميل عند تحميل المشهد
        scene.addEventListener('loaded', function() {
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    startButton.style.display = 'block';
                }, 500);
            }, 2000);
        });
        
        // بدء التجربة عند النقر على الزر
        startButton.addEventListener('click', function() {
            if (!sceneStarted) {
                startARExperience();
            }
        });
        
        // دالة لبدء تجربة الواقع المعزز
        function startARExperience() {
            startButton.style.display = 'none';
            arScene.style.display = 'block';
            sceneStarted = true;
            statusBar.textContent = 'جارٍ البحث عن الأسطح...';
            instructions.textContent = 'حرك هاتفك ببطء لاكتشاف الأسطح';
            
            // محاكاة اكتشاف السطح بعد فترة
            setTimeout(() => {
                if (!surfaceDetected && !cubePlaced) {
                    surfaceDetected = true;
                    surfaceIndicator.classList.add('active');
                    surfaceMessage.classList.add('active');
                    tapHint.classList.add('active');
                    hint.style.opacity = '0';
                    statusBar.textContent = 'تم اكتشاف سطح - انقر لوضع المكعب';
                    
                    // عرض شبكة السطح
                    surfaceGrid.setAttribute('visible', 'true');
                    
                    // تحديث التعليمات
                    instructions.textContent = 'انقر في أي مكان على الشاشة لوضع المكعب';
                }
            }, 3000);
        }
        
        // إصلاح مشكلة النقر - استخدام حدث النقر على المستند
        document.addEventListener('click', function() {
            if (surfaceDetected && !cubePlaced && sceneStarted) {
                placeCube();
            }
        });
        
        // إصلاح مشكلة النقر - استخدام اللمس للأجهزة المحمولة
        document.addEventListener('touchstart', function(e) {
            if (surfaceDetected && !cubePlaced && sceneStarted) {
                e.preventDefault();
                placeCube();
            }
        }, { passive: false });
        
        // دالة لوضع المكعب
        function placeCube() {
            if (surfaceDetected && !cubePlaced && sceneStarted) {
                const camera = document.querySelector('[camera]');
                const cameraPosition = camera.getAttribute('position');
                
                // وضع المكعب أمام الكاميرا مباشرة
                cube.setAttribute('position', {
                    x: cameraPosition.x,
                    y: cameraPosition.y - 0.5,
                    z: cameraPosition.z - 1.5
                });
                
                cube.setAttribute('visible', 'true');
                cubePlaced = true;
                
                // إخفاء إشارات السطح
                surfaceIndicator.classList.remove('active');
                surfaceMessage.classList.remove('active');
                surfaceGrid.setAttribute('visible', 'false');
                tapHint.classList.remove('active');
                hint.style.display = 'none';
                statusBar.textContent = 'تم وضع المكعب - حرك هاتفك حوله';
                
                // تحديث التعليمات
                instructions.textContent = 'جرب التحرك حول المكعب لمشاهدته من جميع الزوايا';
                
                // إضافة تأثير عند الظهور
                cube.setAttribute('animation__scale', {
                    property: 'scale',
                    from: '0.1 0.1 0.1',
                    to: '1 1 1',
                    dur: 800,
                    easing: 'easeOutElastic'
                });
                
                // تحديث رقم الإصدار بعد وضع المكعب
                version.textContent = 'الإصدار 2.1.5';
            }
        }
        
        // محاكاة فقدان السطح واكتشافه مرة أخرى (لأغراض العرض)
        setInterval(() => {
            if (!cubePlaced && sceneStarted) {
                surfaceDetected = !surfaceDetected;
                
                if (surfaceDetected) {
                    surfaceIndicator.classList.add('active');
                    surfaceMessage.classList.add('active');
                    tapHint.classList.add('active');
                    surfaceGrid.setAttribute('visible', 'true');
                    hint.style.opacity = '0';
                    statusBar.textContent = 'تم اكتشاف سطح - انقر لوضع المكعب';
                    instructions.textContent = 'انقر في أي مكان على الشاشة لوضع المكعب';
                } else {
                    surfaceIndicator.classList.remove('active');
                    surfaceMessage.classList.remove('active');
                    tapHint.classList.remove('active');
                    surfaceGrid.setAttribute('visible', 'false');
                    hint.style.opacity = '0.8';
                    statusBar.textContent = 'جار البحث عن الأسطح...';
                    instructions.textContent = 'حرك هاتفك ببطء لاكتشاف الأسطح';
                }
            }
        }, 8000);
        
        // تحديث رقم الإصدار تلقائياً كل 10 ثوانٍ (لأغراض العرض)
        let versionCounter = 2.1;
        setInterval(() => {
            if (!cubePlaced && sceneStarted) {
                versionCounter += 0.1;
                version.textContent = `الإصدار ${versionCounter.toFixed(1)}`;
            }
        }, 10000);
        
        // التحقق من أخطاء الكاميرا
        setTimeout(() => {
            if (!sceneStarted) {
                errorMessage.style.display = 'block';
                startButton.style.display = 'none';
            }
        }, 10000);
        
        // منع السلوك الافتراضي للمس (لمنع التكبير/التصغير غير المرغوب فيه)
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>